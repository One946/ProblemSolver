<!DOCTYPE html>
<html lang="it">
<head>
	<meta charset="utf-8" />
	<title>2.0</title>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	
	<link rel="stylesheet" type="text/css" href="http://localhost/2.0/css/main.css">
</head>
<body class="parallax">
		<!-- navbar -->
			<nav class="navbar" style="   position: -webkit-sticky;
			position: sticky;
			top: 0;
			z-index:1;">
				<span class="open-slide">
					<a href="#" onclick="openSlideMenu()">
					  <svg width="30" height="30">
							<path d = "M0,5 30,5" stroke="#fff" stroke-width="5"/>
							<path d = "M0,14 30,14" stroke="#fff" stroke-width="5"/>
							<path d = "M0,23 30,23" stroke="#fff" stroke-width="5"/>
						</svg>
					</a>
				</span>
				<ul class="navbar-nav">
					<li><a href="http://localhost/2.0/index.html">Home</a></li>
					<li><a href="http://localhost/2.0/problemi.html">Naviga Problemi</a></li>
					<li><a href="http://localhost/2.0/report.html">Riporta Problema</a></li>
					<li><a href="http://localhost/2.0/login.html">Login/Registrati</a></li>
					<li><a href="http://localhost/2.0/cerca.html"> Cerca Problemi</a><li>
					<li><button id="p"style="background-color:#3b5998; color:white; border:none;margin-top:15px;">LogOut</button>
				</ul>
					<script>
						//verifico se l'utente è loggato
						var logged = document.cookie.substring(document.cookie.indexOf("secretID:"),document.cookie.indexOf(";"));
						var a = logged.split("=");
						var id = parseInt(a[1]);
						if(!isNaN(id)){
							document.getElementById("p").style.visibility="visibile";
						}else{
							document.getElementById("p").style.visibility="hidden";
						}
	
	
						document.getElementById("p").addEventListener("click",logout);
						//funzione di logout
					function logout(){
						var d = new Date();
						  d.setTime(d.getTime() *0);
						  var expires = "expires="+ d.toUTCString();
						  console.log(document.cookie);
						  console.log(document.cookie["secretID"]);
						  //document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
						document.cookie="secretID"+"="+document.cookie+";"+expires+"path=/"
						console.log(document.cookie);
					}
					</script>

			</nav>
		<!--Menu a scomparsa-->
			<div id="side-menu" class="side-nav">
					<a href="#" class="btn-close" onclick="closeSlideMenu()">&times;</a>
					<a href="#">Home</a>
					<a href="#">Naviga Problemi</a></a>
					<a href="#">Riporta Problema</a>
					<a href="#">Login/Registrati</a>
			</div>

			<div id="problemi"></div>
			<div id="problema"></div>




	<script>
		//selezione il div padre che conterrà tutti i problemi
		var div= document.getElementById("problemi");//div contine l'anteprima di tutti i problemi
		var div2= document.getElementById("problema");//div2 contiene il singolo problema

		//invio la richiesta per richiedere i problemi
		var xhr = new XMLHttpRequest();
		xhr.open('GET','http://localhost/2.0/php/problemi.php');
		xhr.onload=function(){
			var arrProb =JSON.parse(this.responseText);
			spawn(arrProb);
		};
		xhr.send();
	


		// funzione di visualizzazione problemi
		function spawn(data){
			var testo= "";
			var link = "";
		// visualizzo i problemi
			for(i=0; i< data.length; i++){
				testo += "<div style='opacity:0.95; background: #f4f4f4; margin: auto; width:1000px; border-radius: 20px; text-align: center; color: #3b5998;   '><h1>"+data[i].titolo+ "</h1> <p id='p"+data[i].idProblema+"'> problema numero:"+data[i].idProblema+"</p> <button id='b"+data[i].idProblema+"' onclick=showP("+data[i].idProblema+",formattazione)> Per saperne di più! </button></div> <br>";
				//link  += "<button> Per saperne di più! </button>"
			}
			div.insertAdjacentHTML("beforeend",testo+link); //comando per inserire elementi nel dom
		}

		//funzione visualizzazione singolo problema
//****************************************************************************************************
		//funzione formattazione problema
		function formattazione(prob){
				var k;
				var testo;
				var l = prob.tag.length;
				var tag="";
				var i=0;
				while(l>i){
					tag+= " "+prob.tag[i];
					i++;
				}
				//Formattazione problema
				if(prob.anonimo){
					k="l'utete ha deciso di effettuare la segnalazione in maniera anonima"
				}
				else{
					k="segnalazione effettuata dall'utente numero: "+prob.problema.secretID+".  Che corrisconde all'utente: FEFIFFO ";//+ut.Nome+" "+ut.Cognome;
				}
			//	testo="<div  class='stripe'> <p> ID problema : "+prob.idProblema+"</p> <div> <h1>"+prob.titolo+"</h1><br><p>"+prob.descrizione+"</p><br><p>"+k+"</p><br><p><b>tag:</b> "+tag+"</p></div></div>"; //troppo hard coded? come torno indietro? basta cliccare sulla bara o devo mettere un pulsante? i commenti?
			testo="<div  class='stripe'> <p> ID problema : "+prob.problema.idProblema+"</p> <div> <h1>"+prob.problema.titolo+"</h1><br><p>"+prob.problema.descrizione+"</p><br><p>"+k+"</p><br><p><b>tag:"+tag+"</b> </p></div></div>";
				div.insertAdjacentHTML("afterbegin",testo);
			};

		//showP(idP,formattazione)
		function showP(idP, formattazione){
			
			figli=div.getElementsByTagName("div");//.style.visibility = "hidden"; //nascondo gli altri problemi
			for(i=0;i<figli.length;i++){
				figli[i].style.visibility="hidden";
			};


			var xhr1 = new XMLHttpRequest();
			xhr1.open('POST','http://localhost/2.0/php/problema.php');//uttente problema e tag nella stessa query
			xhr1.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
						x=(JSON.parse(this.responseText));
						formattazione(x);
				}
			};
			xhr1.send(idP);

		};



//*****************************************************************************************************		








			//script per aprire e chiudere il menù a scomparsa in modalità mobile
		function openSlideMenu(){
			document.getElementById("side-menu").style.width="250px"
			document.getElementById("main.").style.marginLeft="250px"
		}
		function closeSlideMenu(){
			document.getElementById("side-menu").style.width="0px"
			document.getElementById("main.").style.marginLeft="0px"
		}
		</script>
</body>
</html>